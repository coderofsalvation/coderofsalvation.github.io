<!DOCTYPE html>
  <html id="home" lang="en">
  <head>
  <meta charset=utf-8 />
  <meta name="viewport" content="width=620" />
  <title>Storing retrieving hierarchical trees between php and mysql </title>
  </head>
  <body>
  
  
  <div style="padding: 0em 0em 1.0em 0em; margin: 0em 0em 1.0em 0em; float:left; width:28.0em">
    <a href="../" target="_blank">
      <img src="res/logo_small.png" style="text-align:left"/>
    </a>
    <span style="font-size:0.7em; color:#079;">
      Coder of Salvation&#8482; &nbsp; &#8212; programming / opensource / console / minimal
    </span>
  </div>

  <div style="width:20.0em;float:right">
    <select style="width:100%" onchange="document.location.href = this.options[ this.selectedIndex ].value">
      	<option   value="index.html">/&nbsp;Home</option> 	<option   value="actionscript-trace-cpu-hogs.html">&nbsp;Actionscript trace cpu hogs </option>
	<option   value="advanced-git-aliases-for-ninjas.html">&nbsp;Advanced git aliases for ninjas </option>
	<option   value="automatic-tracing-handdrawn-scans-into-vector-images-in-linux.html">&nbsp;Automatic tracing handdrawn scans into vector images in linux </option>
	<option   value="avs-vjgen-an-triggercode-generator.html">&nbsp;Avs vjgen an triggercode generator </option>
	<option   value="clever-code-toggling.html">&nbsp;Clever code toggling </option>
	<option   value="conditional-cron-is-our-friend.html">&nbsp;Conditional cron is our friend </option>
	<option   value="emailing-poormans-ascii-graphs-using-unix-tree.html">&nbsp;Emailing poormans ascii graphs using unix tree </option>
	<option   value="flexible-sql-columns-for-production-servers.html">&nbsp;Flexible sql columns for production servers </option>
	<option   value="githooks-the-minimist-quality-assurance-tool.html">&nbsp;Githooks the minimist quality assurance tool </option>
	<option   value="imapmunch-easy-way-to-select-and-parse-imap-email-on-the-commandline.html">&nbsp;Imapmunch easy way to select and parse imap email on the commandline </option>
	<option   value="javascript-errors-on-productionservers.html">&nbsp;Javascript errors on productionservers </option>
	<option   value="javascript-memory-leaks.html">&nbsp;Javascript memory leaks </option>
	<option   value="javascript-simple-plugin-system.html">&nbsp;Javascript simple plugin system </option>
	<option   value="looping-over-array-in-node-red-nodejs-iteration.html">&nbsp;Looping over array in node red nodejs iteration </option>
	<option   value="md2x-a-minimalistic-markdown-bashscript.html">&nbsp;Md2x a minimalistic markdown bashscript </option>
	<option   value="mobile-webapps-are-great.html">&nbsp;Mobile webapps are great </option>
	<option   value="mysql-pagers-get-more-overview.html">&nbsp;Mysql pagers get more overview </option>
	<option   value="npm-git-cloning-private-bitbucket-repository-with-ssh-key-on-openshift.html">&nbsp;Npm git cloning private bitbucket repository with ssh key on openshift </option>
	<option   value="shellscript-framework-make-quick-bash-scripts.html">&nbsp;Shellscript framework make quick bash scripts </option>
	<option   value="simple-bash-script-to-document-REST-api.html">&nbsp;Simple bash script to document REST api </option>
	<option   value="snippy-autocompletion-for-console-and-browser-window-manager-using-bash.html">&nbsp;Snippy autocompletion for console and browser window manager using bash </option>
	<option selected='selected'  value="storing-retrieving-hierarchical-trees-between-php-and-mysql.html">&nbsp;Storing retrieving hierarchical trees between php and mysql </option>
	<option   value="switch-coffeescript-and-javascript-in-vim-like-a-ninja.html">&nbsp;Switch coffeescript and javascript in vim like a ninja </option>
	<option   value="the-ultimate-dataformat-for-bash-is-tabular-data-but-how-to-use-it.html">&nbsp;The ultimate dataformat for bash is tabular data but how to use it </option>
	<option   value="typesafe-functions-and-nested-variables-in-php-javascript-and-coffeescript-using-typesafe.html">&nbsp;Typesafe functions and nested variables in php javascript and coffeescript using typesafe </option>
	<option   value="utilities-for-xi-and-sf2-looped-instruments-to-aiff-wav.html">&nbsp;Utilities for xi and sf2 looped instruments to aiff wav </option>
	<option   value="vim-mappingmanager-organize-your-mappings.html">&nbsp;Vim mappingmanager organize your mappings </option>
	<option   value="xdebug-bashscript-to-profile-and-debug-php.html">&nbsp;Xdebug bashscript to profile and debug php </option>
	<option   value="you-better-use-snippets-son.html">&nbsp;You better use snippets son </option>
    </select>
  </div>
  <div style="clear:both;border-bottom:1px solid #CCC; "></div>

  <link rel="stylesheet" href="http://leon.vankammen.eu/public/css/poole.css">
  <link rel="stylesheet" href="http://leon.vankammen.eu/public/css/syntax.css">
  <link rel="stylesheet" href="http://leon.vankammen.eu/public/css/style.css">
  <link href="http://fonts.googleapis.com/css?family=Finger+Paint" rel="stylesheet" type="text/css" id="link-webfont">
  <style type="text/css">
    select { padding:0.5em; font-size: 0.7em; }
    body { padding: 10%; padding-top: 2.0em; }
    pre{ font-size: 0.7em; }
    code { color:#268Bd2; }
  </style>
<h1>PHP, Mysql and hierarchical trees</h1>
<h3>Statement </h3>
<p><em>Hierarchical structures in mySQL &amp; PHP needs preperation</em></p>
<h3>Scenario </h3>
<p>Its easy to create relations in mySQL by connecting columns. However, once you are in PHP, its not really easy to convert this into an associative array. Because when you select all needed records from the database, you get a plain list of all nodes.</p>
<h3>How to convert records to nodes </h3>
<p>Basically, you need to know which is who's parent, and at what position(weight) the node should be positioned.</p>
<h3>Example </h3>
<p>Suppose your sql table layout is :</p>
<code><pre>
+------------------+
| id(int11)        |
| parent_id(int11) |
| weight(int11)    | &lt;- amazing ascii-art
| title_menu(text) |    
| content(text)    |
+------------------+
</pre></code>
<h3>PHP Code </h3>
<code><pre>
$treeManager     = treeManager::get();
$records         = $db->getArrayFromSql( "SELECT * FROM mytable" );
// here we have our multidimensional, weightsorted tree!
$recordsTree     = $treeManager->getTree( $records );
// here we have this tree slapped into a one-dimensional sorted, indented list
$recordsSlapped  = $treeManager->slapTree( $records );
// and vice versa!
$recordsTree     = $treeManager->getTree( $recordsSlapped );
// lets view our tree in text/html!
foreach( $recordsSlapped as $node )
  echo "{$node['title_menu_indent']}\n";
</pre></code>
<h3>Output </h3>
<code><pre>
/root A
   / child 1
   / child 2
/root B
   / child Y
      / child Z
</pre></code>
<h3>Explanation </h3>
<p>Obviously the class is responding to a naming convention for columns (<code>id</code> / <code>parent_id</code> / <code>weight</code> ). But..it is possible to pass alternative naming conventions as optional arguments to the function.</p>
<h3>Why this class </h3>
<p>This class which makes life easier when it comes to storing/retrieving hierarchical arrays (trees) from the database. When you use this, you will be saved from lots of work.</p>
<p>the idea is to do two-way conversion of tree's and indented lists easily. Why? So you can easily store the structure in the database, and easily render this structure into a html selectionbox/menus etc. Think of it as some kind of 'serialize/unserialize' function, but with having the search-benefits of SQL. I hope you have fun with these trees!</p>
<h3>Example: from MySQL to PHP </h3>
<p>Suppose this is our datastructure (from SQL/PHP).   </p>
<code><pre>
$records      = array(  0 => array(  "id"        => 23,
                                     "parent_id" => 0,
                                     "title_menu" => "root A",
                                     "weight"    => 1 ),
                        5 => array(  "id"        => 24,
                                     "parent_id" => 23,
                                     "title_menu" => "child 2",
                                     "weight"    => 3 ),
                        2 => array(  "id"        => 25,
                                     "parent_id" => 0,
                                     "title_menu" => "root B",
                                     "weight"    => 1 ),
                        3 => array(  "id"        => 26,
                                     "parent_id" => 25,
                                     "title_menu" => "child Y",
                                     "weight"    => 1 ),
                        4 => array(  "id"        => 27,
                                     "parent_id" => 26,
                                     "title_menu" => "child Z",
                                     "weight"    => 1 ),
                        1 => array(  "id"        => 24,
                                     "parent_id" => 23,
                                     "title_menu" => "child 1",
                                     "weight"    => 1 )
                      );
// convert to multidimensional weight-sorted array
$recordsTree    = getTree( $records );
print_r($recordsTree);
</pre></code>
<h3>Output </h3>
<code><pre>
Array(
    [0] => Array
        (
            [id] => 23
            [parent_id] => 0
            [title_menu] => root A
            [weight] => 1
            [children] => Array
                (
                    [1] => Array
                        (
                            [id] => 24
                            [parent_id] => 23
                            [title_menu] => child 1
                            [weight] => 1
                            [children] => Array
                                (
                                )
                        )
                    [3] => Array
                        (
                            [id] => 24
                            [parent_id] => 23
                            [title_menu] => child 2
                            [weight] => 3
                            [children] => Array
                                (
                                )
                        )
                )
        )
    [2] => Array
        (
            [id] => 25
            [parent_id] => 0
            [title_menu] => root B
            [weight] => 1
            [children] => Array
                (
                    [1] => Array
                        (
                            [id] => 26
                            [parent_id] => 25
                            [title_menu] => child Y
                            [weight] => 1
                            [children] => Array
                                (
                                    [1] => Array
                                        (
                                            [id] => 27
                                            [parent_id] => 26
                                            [title_menu] => child Z
                                            [weight] => 1
                                            [children] => Array
                                                (
                                                )
                                        )
                                )
                        )
                )
        )
)
</pre></code>
<h3>Example: from hierarchical to records </h3>
<code><pre>
// convert to indented onedimensional weight-sorted array
$recordsSlapped = slapTree( $recordsTree);
foreach($recordsSlapped as $record )
  echo $record['menu_title_indent'] . '\n';
print_r($recordsSlapped);
</pre></code>
<h3>Output </h3>
<code><pre>
/root A
   / child 1
   / child 2
/root B
   / child Y
      / child Z
Array
(
    [0] => Array
        (
            [id] => 23
            [parent_id] => 0
            [title_menu] => root A
            [weight] => 1
            [indent] => 0
            [title_menu_indent] => /root A
            [title_menu_path] => /root A
        )
    [1] => Array
        (
            [id] => 24
            [parent_id] => 23
            [title_menu] => child 1
            [weight] => 1
            [indent] => 3
            [title_menu_path] => /root A/child 1
            [title_menu_indent] =>    / child 1
        )
    [2] => Array
        (
            [id] => 24
            [parent_id] => 23
            [title_menu] => child 2
            [weight] => 3
            [indent] => 3
            [title_menu_path] => /root A/child 2
            [title_menu_indent] =>    / child 2
        )
    [3] => Array
        (
            [id] => 25
            [parent_id] => 0
            [title_menu] => root B
            [weight] => 1
            [indent] => 0
            [title_menu_indent] => /root B
            [title_menu_path] => /root B
        )
    [4] => Array
        (
            [id] => 26
            [parent_id] => 25
            [title_menu] => child Y
            [weight] => 1
            [indent] => 3
            [title_menu_path] => /root B/child Y
            [title_menu_indent] =>    / child Y
        )
    [5] => Array
        (
            [id] => 27
            [parent_id] => 26
            [title_menu] => child Z
            [weight] => 1
            [indent] => 6
            [title_menu_path] => /root B/child Y/child Z
            [title_menu_indent] =>       / child Z
        )
)
</pre></code>
<h3>Example: and vice versa </h3>
<code><pre>
$recordsTree     = getTree( $recordsSlapped );
print_r($recordsTree);
</pre></code>
<h3>Output: </h3>
<code><pre>
Array
(
    [0] => Array
        (
            [id] => 23
            [parent_id] => 0
            [title_menu] => root A
            [weight] => 1
            [indent] => 0
            [title_menu_indent] => /root A
            [title_menu_path] => /root A
            [children] => Array
                (
                    [1] => Array
                        (
                            [id] => 24
                            [parent_id] => 23
                            [title_menu] => child 1
                            [weight] => 1
                            [indent] => 3
                            [title_menu_path] => /root A/child 1
                            [title_menu_indent] =>    / child 1
                            [children] => Array
                                (
                                )
                        )
                    [3] => Array
                        (
                            [id] => 24
                            [parent_id] => 23
                            [title_menu] => child 2
                            [weight] => 3
                            [indent] => 3
                            [title_menu_path] => /root A/child 2
                            [title_menu_indent] =>    / child 2
                            [children] => Array
                                (
                                )
                        )
                )
        )
    [3] => Array
        (
            [id] => 25
            [parent_id] => 0
            [title_menu] => root B
            [weight] => 1
            [indent] => 0
            [title_menu_indent] => /root B
            [title_menu_path] => /root B
            [children] => Array
                (
                    [1] => Array
                        (
                            [id] => 26
                            [parent_id] => 25
                            [title_menu] => child Y
                            [weight] => 1
                            [indent] => 3
                            [title_menu_path] => /root B/child Y
                            [title_menu_indent] =>    / child Y
                            [children] => Array
                                (
                                    [1] => Array
                                        (
                                            [id] => 27
                                            [parent_id] => 26
                                            [title_menu] => child Z
                                            [weight] => 1
                                            [indent] => 6
                                            [title_menu_path] => /root B/child Y/child Z
                                            [title_menu_indent] =>       / child Z
                                            [children] => Array
                                                (
                                                )
                                        )
                                )
                        )
                )
        )
)
</pre></code>
<h3>Download </h3>
<p>Download <a href="res/treemanager.zip">here</a></p>
  <br><br>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "coderofsalvation"; // required: replace example with your forum shortname

      /* * * DONT EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
          dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
          (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
  <br><Br>
  <img src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png"/><br>
  <small>All rights reserved by Leon van Kammen under this <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.en_US" target="_blank">license</a></small>
    <!-- Analytics
    ================================================== -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(["_setAccount", "UA-10900009-2"]);
    _gaq.push(["_trackPageview"]);
    (function() {
      var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
      ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
      var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body></html>
