<!DOCTYPE html>
  <html id="home" lang="en">
  <head>
  <meta charset=utf-8 />
  <meta name="viewport" content="width=620" />
  <title>Shellscript framework make quick bash scripts </title>
  </head>
  <body>
  
  
  <div style="padding: 0em 0em 1.0em 0em; margin: 0em 0em 1.0em 0em; float:left; width:32.0em">
    <a href="../" target="_blank">
      <img src="res/logo_small.png" style="text-align:left"/>
    </a>
    <span style="font-size:0.7em; color:#079;">
      Coder of Salvation&#8482; &nbsp; &#8212; programming / opensource / console / minimal
    </span>
  </div>

  <div style="width:20.0em;float:right">
    <select style="width:100%" onchange="document.location.href = this.options[ this.selectedIndex ].value">
      	<option   value="index.html">/&nbsp;Home</option> 	<option   value="actionscript-trace-cpu-hogs.html">&nbsp;Actionscript trace cpu hogs </option>
	<option   value="advanced-git-aliases-for-ninjas.html">&nbsp;Advanced git aliases for ninjas </option>
	<option   value="automatic-tracing-handdrawn-scans-into-vector-images-in-linux.html">&nbsp;Automatic tracing handdrawn scans into vector images in linux </option>
	<option   value="avs-vjgen-an-triggercode-generator.html">&nbsp;Avs vjgen an triggercode generator </option>
	<option   value="clever-code-toggling.html">&nbsp;Clever code toggling </option>
	<option   value="conditional-cron-is-our-friend.html">&nbsp;Conditional cron is our friend </option>
	<option   value="emailing-poormans-ascii-graphs-using-unix-tree.html">&nbsp;Emailing poormans ascii graphs using unix tree </option>
	<option   value="flexible-sql-columns-for-production-servers.html">&nbsp;Flexible sql columns for production servers </option>
	<option   value="githooks-the-minimist-quality-assurance-tool.html">&nbsp;Githooks the minimist quality assurance tool </option>
	<option   value="imapmunch-easy-way-to-select-and-parse-imap-email-on-the-commandline.html">&nbsp;Imapmunch easy way to select and parse imap email on the commandline </option>
	<option   value="javascript-errors-on-productionservers.html">&nbsp;Javascript errors on productionservers </option>
	<option   value="javascript-memory-leaks.html">&nbsp;Javascript memory leaks </option>
	<option   value="javascript-simple-plugin-system.html">&nbsp;Javascript simple plugin system </option>
	<option   value="looping-over-array-in-node-red-nodejs-iteration.html">&nbsp;Looping over array in node red nodejs iteration </option>
	<option   value="md2x-a-minimalistic-markdown-bashscript.html">&nbsp;Md2x a minimalistic markdown bashscript </option>
	<option   value="mobile-webapps-are-great.html">&nbsp;Mobile webapps are great </option>
	<option   value="mysql-pagers-get-more-overview.html">&nbsp;Mysql pagers get more overview </option>
	<option   value="npm-git-cloning-private-bitbucket-repository-with-ssh-key-on-openshift.html">&nbsp;Npm git cloning private bitbucket repository with ssh key on openshift </option>
	<option selected='selected'  value="shellscript-framework-make-quick-bash-scripts.html">&nbsp;Shellscript framework make quick bash scripts </option>
	<option   value="simple-bash-script-to-document-REST-api.html">&nbsp;Simple bash script to document REST api </option>
	<option   value="snippy-autocompletion-for-console-and-browser-window-manager-using-bash.html">&nbsp;Snippy autocompletion for console and browser window manager using bash </option>
	<option   value="storing-retrieving-hierarchical-trees-between-php-and-mysql.html">&nbsp;Storing retrieving hierarchical trees between php and mysql </option>
	<option   value="switch-coffeescript-and-javascript-in-vim-like-a-ninja.html">&nbsp;Switch coffeescript and javascript in vim like a ninja </option>
	<option   value="the-ultimate-dataformat-for-bash-is-tabular-data-but-how-to-use-it.html">&nbsp;The ultimate dataformat for bash is tabular data but how to use it </option>
	<option   value="typesafe-functions-and-nested-variables-in-php-javascript-and-coffeescript-using-typesafe.html">&nbsp;Typesafe functions and nested variables in php javascript and coffeescript using typesafe </option>
	<option   value="utilities-for-xi-and-sf2-looped-instruments-to-aiff-wav.html">&nbsp;Utilities for xi and sf2 looped instruments to aiff wav </option>
	<option   value="vim-mappingmanager-organize-your-mappings.html">&nbsp;Vim mappingmanager organize your mappings </option>
	<option   value="xdebug-bashscript-to-profile-and-debug-php.html">&nbsp;Xdebug bashscript to profile and debug php </option>
	<option   value="you-better-use-snippets-son.html">&nbsp;You better use snippets son </option>
    </select>
  </div>
  <div style="clear:both;border-bottom:1px solid #CCC; "></div>

  <link rel="stylesheet" href="http://leon.vankammen.eu/public/css/poole.css">
  <link rel="stylesheet" href="http://leon.vankammen.eu/public/css/syntax.css">
  <link rel="stylesheet" href="http://leon.vankammen.eu/public/css/style.css">
  <link href="http://fonts.googleapis.com/css?family=Finger+Paint" rel="stylesheet" type="text/css" id="link-webfont">
  <style type="text/css">
    pre{ font-size: 0.7em; }
    code { color:#268Bd2; }
  </style>
<h1>Shellscripting the fast way</h1>
<h3>Statement </h3>
<p><em>Shellscript allows you to mashup all programminglanguages at once, so learning it <code>as a swiss armyknife</code> really pays off in the longterm</em></p>
<p>Especially when developing with vim or emacs, the testing/implementing-cycle is really fast, since you can execute shellscripts from the editor itself.</p>
<h3>Why a framework is handy </h3>
<p>Check out the minimal shellscript framework below, which I found to be very very productive. It was inspired by <a href="https://github.com/lmartinking/monkey-tail">monkeytail</a> After developing a bit with it, I discovered the snippet below is an extract of its magic.</p>
<code><pre>
#!/bin/bash

_usage(){
    grep "^[^_].\+(){$" $0 | while read line; do 
      echo "  $0 $line" | sed "s/().*//g"; 
    done; 
    echo "";
}

foo(){
  echo "executing foo!"
}

# run arguments as commands if any, or show Usage
"$@"
if [ ${#1} == 0 ]; then echo "$CMDS" | echo "Usage: "; _usage; fi
</pre></code>
<h3>Explanation </h3>
<p>Ok, basically you have private functions (starting with an underscore) and public functions.  The script will list the available public functions (which are commands) by default (if no argument is given). So on the commandline you can do:</p>
<code><pre>
$ chmod 755 myshellscript 
$ ./myshellscript 
  
  Usage:
    myshellscript foo

$ myshellscript foo
executing foo!
</pre></code>
<h3>Nitro inside your editor </h3>
<p>Shellscripts turns vim/emacs/etc into a IDE without any problems.  For example, in vim you can do:</p>
<code><pre>
:!./%          &lt;-- runs current script as external command 
  
  Usage:
    myshellscript foo
:!./% foo
executing foo!
:!man curl     &lt;-- gives manual about curl command 
:!read --help  &lt;-- gives manual about read command
</pre></code>
<h3>Fast workflow </h3>
<p>The development workflow mentioned above can really improve your productivity.  The shellscript language can be very picky about spaces and ';' signs, but it  really pays off when you get the hang of it, and start using functions.  You can start mixing all languages right away: </p>
<code><pre>
examplemix(){
  local msg=$1
  local foo=$(perl -e "$msg"); 
  local bar=$(php -r "echo md5('$msg');")
}
example "this is a message"
</pre></code>
<p><br></p>
<blockquote>
<p><strong>Demo:</strong></p>
<p><div><script id="playterm-MjAxMi0wNi9jb2RlbWFzaHVwdHR5cmVjLTEzMzg1NDE2Nzl8ODB4MjQ=" type="text/javascript" src="http://playterm.org/js/?hash=MjAxMi0wNi9jb2RlbWFzaHVwdHR5cmVjLTEzMzg1NDE2Nzl8ODB4MjQ=" class="size:80x24"></script></div><br></p>
</blockquote>
<h3>Automatic documentation </h3>
<p>We could also extend our framework with autodocumentation. In the following example we supply a comment for every funtion, and a modified _usage() function.</p>
<code><pre>
# this will echo 'hello world'
foo(){
  echo "hello world"
}
_usage(){
  grep "^[^_].\+(){$" $0 | while read line; do
    local cmd=$(echo "$line" | sed "s/(){//g")
    local info=$(grep -C0 -A0 -B1 "$cmd(){" $0 | sed "N;s/\n.*//g" )
    printf "    $0 %-20s %-40s\n" "$cmd" "$info" | grep "#"
  done; echo "";
}
</pre></code>
<h3>Output </h3>
<code><pre>
$ ./myshellscript
  Usage:
    ./myshellscript foo         # this will echo 'hello world'
</pre></code>
<h3>Check requirements </h3>
<p>It would be sad if people get all excited about a shellscript, to find out it doesnt work on their system. Therefore, lets be very serious about it in advance. Lets check if our commands are available like this: </p>
<code><pre>
requirements="sed grep printf cut sort php echo clear"
...
checkrequirements(){
  for req in $requirements; do
    hash "$req" 2>&amp;-
    if [ $? == 1 ]; then echo "please install '$req'"; exit; fi
  done;
}
</pre></code>
<h3>Embed a manpage </h3>
<p>To really top it off, lets add a manual (manpage) to really make it comfortable. (Note: you could add 'pod2man' to the requirements-list mentioned above) Also note the extended maincode on the bottom (before the manual).</p>
<code><pre>
(code)
manual(){
  if [ "$1" != "--manual" ]; then return 0; fi
  local tempfile="/tmp/foo.1"
  hash pod2man 2>&amp;-
  if [ $? == 1 ]; then echo "please install perl"; exit; fi
  SCRIPT=`readlink -f $0`
  echo "(please wait..)"
  pod2man $SCRIPT > "$tempfile"
  clear
  if [ -f "$tempfile" ]; then man "$tempfile"; rm "$tempfile"; fi
  exit 0
}
manual "$1" &amp;&amp; test $# -lt 2 &amp;&amp; checkrequirements &amp;&amp; usage &amp;&amp; exit 65
"$@"
exit 0
&lt;&lt;=cut
=head1 NAME
   foo - a great cmdline utility
=head1 SYNOPSIS
   This utility demystifies the wonderfull world of ...
=head1 DESCRIPTION
It does x and y..
=head1 SEE ALSO
L&lt;foo>, L&lt;bar>
=head1 LICENSE
BSD License (so everybody can enjoy it)
=head1 AUTHOR
B&lt;Y>our name
=cut
</pre></code>
<h3>  Conclusion </h3>
<p>Shellscript rocks, is available on every *NIX system, and it will never die. I hereby take back all insults I did in the past about this language ;)  An example of all methods mentioned above: <a href="https://gist.github.com/1916309" target="_blank">https://gist.github.com/1916309</a></p>
<h3>Resources </h3>
<ul>
<li>
on channel #bash (FREENODE IRC) there the gurus are
</li><li>
<a href="http://wiki.bash-hackers.org">http://wiki.bash-hackers.org</a>
</li>
</ul>
  <br><br>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = "coderofsalvation"; // required: replace example with your forum shortname

      /* * * DONT EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
          dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
          (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
  <br><Br>
  <img src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png"/><br>
  <small>All rights reserved by Leon van Kammen under this <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.en_US" target="_blank">license</a></small>
    <!-- Analytics
    ================================================== -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(["_setAccount", "UA-10900009-2"]);
    _gaq.push(["_trackPageview"]);
    (function() {
      var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
      ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
      var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body></html>
